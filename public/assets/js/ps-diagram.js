(()=>{(()=>{var N={236:(l,n,s)=>{var e=s(4117);e.__esModule&&(e=e.default),typeof e=="string"&&(e=[[l.id,e,""]]),e.locals&&(l.exports=e.locals);var b=s(5083).A,o=b("4c1eda25",e,!0,{})},1093:(l,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>p});var e=s(9723),b=s.n(e),o=s(5876),v=s.n(o),_=v()(b());_.push([l.id,`.ps-input{border-radius:.375rem;box-shadow:inset 0 1px 1px #00000013;border-color:var(--border-block, #ccc);border-width:1px}.ps-input:focus{border-color:#66afe9;box-shadow:inset 0 1px 1px #00000013,0 0 8px #66afe999}
`,""]);const p=_},4061:l=>{"use strict";l.exports=Vue},4117:(l,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>p});var e=s(9723),b=s.n(e),o=s(5876),v=s.n(o),_=v()(b());_.push([l.id,`.ps-tabs{display:inline-flex;align-items:flex-end;color:var(--font-inverse, #fff)}.ps-tabs>li{position:relative;background-color:var(--bg-block-tabs, #000);border:1px solid transparent}.ps-tabs>li:first-child,.ps-tabs>li.active{border-top-left-radius:5px}.ps-tabs>li:last-child,.ps-tabs>li.active{border-top-right-radius:5px}.ps-tabs>li:hover,.ps-tabs>li.active{color:var(--font-accent, #000);background-color:var(--bg-block-tabs-active, #fff);border-top:1px solid var(--border-block, #ccc);border-right:1px solid var(--border-block, #ccc);border-bottom:1px solid transparent;border-left:1px solid var(--border-block, #ccc);padding-top:4px}.ps-tabs>li>button{font-weight:700;font-size:12px;line-height:1.42857143;border:1px solid transparent;background-color:transparent}
`,""]);const p=_},4405:(l,n,s)=>{"use strict";var e=s(4061);const b={class:"app-content flex flex-col h-full"},o={class:"flex flex-spacebetween flex-align-center border-b",style:{"margin-bottom":"1px"}},v={key:0},_={ref:"diagram",class:"diagram"};function p(a,t,i,m,u,r){const c=(0,e.resolveComponent)("PsTabsEditable");return(0,e.openBlock)(),(0,e.createElementBlock)("div",b,[(0,e.createElementVNode)("div",o,[(0,e.createVNode)(c,{tabs:u.tabs,"active-tab-idx":u.activeTabIdx,editable:u.editing,onTabSwitch:r.switchTab,onTabAdd:r.addTab,onTabRemove:r.removeTab,onTabUpdate:r.updateTab,onTabOrder:r.orderTabs},null,8,["tabs","active-tab-idx","editable","onTabSwitch","onTabAdd","onTabRemove","onTabUpdate","onTabOrder"]),t[10]||(t[10]=(0,e.createTextVNode)()),u.editing?((0,e.openBlock)(),(0,e.createElementBlock)("div",v,[(0,e.createElementVNode)("button",{type:"button",class:"btn-link",onClick:t[0]||(t[0]=(...f)=>r.exportConfig&&r.exportConfig(...f))},`
                    Save
                `),t[6]||(t[6]=(0,e.createTextVNode)(`
                |
                `)),(0,e.createElementVNode)("button",{type:"button",class:"btn-link",onClick:t[1]||(t[1]=f=>a.$refs.import.click())},`
                    Load
                `),t[7]||(t[7]=(0,e.createTextVNode)()),(0,e.createElementVNode)("input",{ref:"import",type:"file",accept:".diagram",class:"hidden",onChange:t[2]||(t[2]=(...f)=>r.importConfig&&r.importConfig(...f))},null,544),t[8]||(t[8]=(0,e.createTextVNode)(`
                |
                `)),(0,e.createElementVNode)("button",{type:"button",class:"btn-link",onClick:t[3]||(t[3]=(...f)=>r.resetConfig&&r.resetConfig(...f))},`
                    Reset
                `),t[9]||(t[9]=(0,e.createTextVNode)(`
                |
                `)),(0,e.createElementVNode)("button",{type:"button",class:"btn-link",onClick:t[4]||(t[4]=(...f)=>r.lock&&r.lock(...f))},`
                    Lock
                `)])):((0,e.openBlock)(),(0,e.createElementBlock)("button",{key:1,type:"button",class:"btn-link",onClick:t[5]||(t[5]=f=>u.editing=!0)},`
                Edit
            `))]),t[11]||(t[11]=(0,e.createTextVNode)()),(0,e.createElementVNode)("div",_,null,512)])}var g=s(9975),x=s(6413);const k={class:"flex items-center gap-2"};function y(a,t,i,m,u,r){const c=(0,e.resolveComponent)("PsTabs"),f=(0,e.resolveComponent)("PsTabsEditableReorder");return(0,e.openBlock)(),(0,e.createElementBlock)("div",k,[i.tabs.length>1||i.editable?((0,e.openBlock)(),(0,e.createBlock)(c,{key:0,tabs:i.tabs,"model-value":i.tabs[i.activeTabIdx],class:"-m-px",onClick:r.onTabClick,"onUpdate:modelValue":r.switchTab},{tab:(0,e.withCtx)(({isActive:T})=>[T&&u.editTabName?((0,e.openBlock)(),(0,e.createElementBlock)("form",{key:0,method:"dialog",onSubmit:t[3]||(t[3]=(0,e.withModifiers)((...h)=>r.saveEdit&&r.saveEdit(...h),["prevent"]))},[(0,e.withDirectives)((0,e.createElementVNode)("input",{ref:"input","onUpdate:modelValue":t[0]||(t[0]=h=>u.tabModel=h),name:"dashboardTabName",class:"ps-input",style:(0,e.normalizeStyle)([{margin:"0 2px"},{borderColor:r.updateWarning?"red":null}]),pattern:"[a-zA-Z0-9 _\\-]+",title:"Allowed: letters, numbers, space, dash, underscore",onKeyup:t[1]||(t[1]=(0,e.withKeys)((...h)=>r.cancelEdit&&r.cancelEdit(...h),["esc"])),onBlur:t[2]||(t[2]=(...h)=>r.cancelEdit&&r.cancelEdit(...h))},null,36),[[e.vModelText,u.tabModel,void 0,{trim:!0}]]),t[8]||(t[8]=(0,e.createTextVNode)()),t[9]||(t[9]=(0,e.createElementVNode)("input",{type:"submit",hidden:""},null,-1))],32)):(0,e.createCommentVNode)("",!0)]),_:1},8,["tabs","model-value","onClick","onUpdate:modelValue"])):(0,e.createCommentVNode)("",!0),t[12]||(t[12]=(0,e.createTextVNode)()),i.editable?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:1},[(0,e.createElementVNode)("button",{type:"button",class:"btn-link",onClick:t[4]||(t[4]=(...T)=>r.addTab&&r.addTab(...T))},`
                New
            `),t[11]||(t[11]=(0,e.createTextVNode)()),r.multiTabs?((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,{key:0},[(0,e.createElementVNode)("button",{type:"button",class:"btn-link",onClick:t[5]||(t[5]=T=>a.$emit("tab-remove"))},`
                    Delete
                `),t[10]||(t[10]=(0,e.createTextVNode)()),(0,e.createVNode)(f,{"model-value":i.tabs,"onUpdate:modelValue":t[6]||(t[6]=T=>a.$emit("tab-order",T))},null,8,["model-value"])],64)):(0,e.createCommentVNode)("",!0)],64)):(0,e.createCommentVNode)("",!0),t[13]||(t[13]=(0,e.createTextVNode)()),i.detachable?((0,e.openBlock)(),(0,e.createElementBlock)("button",{key:2,type:"button",class:"btn-link",onClick:t[7]||(t[7]=T=>a.$emit("detach"))},`
            Detach
        `)):(0,e.createCommentVNode)("",!0)])}const M={class:"ps-tabs"},C=["disabled","onClick","textContent"];function A(a,t,i,m,u,r){return(0,e.openBlock)(),(0,e.createElementBlock)("menu",M,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(i.tabs,c=>((0,e.openBlock)(),(0,e.createElementBlock)("li",{key:c.value,class:(0,e.normalizeClass)({active:r.isActive(c)})},[(0,e.renderSlot)(a.$slots,"tab",{isActive:r.isActive(c),tab:c},()=>[(0,e.createElementVNode)("button",{type:"button",disabled:c.disabled,onClick:f=>r.activate(c),textContent:(0,e.toDisplayString)(c.title)},null,8,C)])],2))),128))])}const w={name:"PsTabs",props:{tabs:{type:Array,required:!0},modelValue:{type:Object,required:!1,default:null}},emits:["update:modelValue","click"],methods:{isActive(a){return a===this.modelValue},activate(a){this.$emit("click",a),!(a.disabled||this.isActive(a))&&this.$emit("update:modelValue",a)}}};var H=s(236),E=s(804);const R=(0,E.A)(w,[["render",A]]),I={style:{"list-style-type":"none",padding:"0"}},S=["value"],U={class:"flex gap-2 pb-10"};function L(a,t,i,m,u,r){const c=(0,e.resolveComponent)("PsBtn"),f=(0,e.resolveComponent)("PsModal");return(0,e.openBlock)(),(0,e.createElementBlock)("button",{type:"button",class:"btn-link",onClick:t[1]||(t[1]=(...T)=>r.openDialog&&r.openDialog(...T))},[t[12]||(t[12]=(0,e.createTextVNode)(`
        Order

        `)),u.dialog?((0,e.openBlock)(),(0,e.createBlock)(f,{key:0,sw:"250px",onClose:r.closeDialog},{header:(0,e.withCtx)(()=>t[2]||(t[2]=[(0,e.createElementVNode)("h2",{class:"devices-title note"},`
                    Order tabs
                `,-1)])),default:(0,e.withCtx)(()=>[(0,e.createElementVNode)("ul",I,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(u.tabs,(T,h)=>((0,e.openBlock)(),(0,e.createElementBlock)("li",{key:T.title},[(0,e.createElementVNode)("label",{class:"pointer ma-0 w-full",style:(0,e.normalizeStyle)([{border:"1px solid var(--border-block, #ccc)",padding:"5px 10px"},{color:h===u.selected?"white":"black",backgroundColor:h===u.selected?"black":"white"}])},[(0,e.withDirectives)((0,e.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=G=>u.selected=G),type:"radio",hidden:"",value:h},null,8,S),[[e.vModelRadio,u.selected]]),(0,e.createTextVNode)(" "+(0,e.toDisplayString)(T.title),1)],4)]))),128))]),t[6]||(t[6]=(0,e.createTextVNode)()),(0,e.createElementVNode)("div",U,[(0,e.createVNode)(c,{disabled:r.upDisabled,onClick:r.moveUp},{default:(0,e.withCtx)(()=>t[3]||(t[3]=[(0,e.createTextVNode)(`
                        Up
                    `)])),_:1,__:[3]},8,["disabled","onClick"]),t[5]||(t[5]=(0,e.createTextVNode)()),(0,e.createVNode)(c,{disabled:r.downDisabled,onClick:r.moveDown},{default:(0,e.withCtx)(()=>t[4]||(t[4]=[(0,e.createTextVNode)(`
                        Down
                    `)])),_:1,__:[4]},8,["disabled","onClick"])])]),footer:(0,e.withCtx)(()=>[(0,e.createVNode)(c,{disabled:!r.isChanged,onClick:r.saveOrder},{default:(0,e.withCtx)(()=>t[7]||(t[7]=[(0,e.createTextVNode)(`
                    OK
                `)])),_:1,__:[7]},8,["disabled","onClick"]),t[9]||(t[9]=(0,e.createTextVNode)()),(0,e.createVNode)(c,{class:"bg-whitesmoke text-black",onClick:r.closeDialog},{default:(0,e.withCtx)(()=>t[8]||(t[8]=[(0,e.createTextVNode)(`
                    Cancel
                `)])),_:1,__:[8]},8,["onClick"])]),_:1,__:[10,11]},8,["onClose"])):(0,e.createCommentVNode)("",!0)])}var j=s(5149),K=s(1858);const W={name:"PsTabsEditableReorder",components:{PsBtn:j.A,PsModal:K.A},props:{modelValue:{type:Array,required:!0}},emits:["update:modelValue"],data(){return{dialog:!1,tabs:[],selected:null}},computed:{isChanged(){const a=this.modelValue,t=this.tabs;return a.length!==t.length?!0:t.some((i,m)=>i.value!==a[m].value)},upDisabled(){return[null,0].includes(this.selected)},downDisabled(){return[null,this.tabs.length-1].includes(this.selected)}},methods:{openDialog(){this.tabs=JSON.parse(JSON.stringify(this.modelValue)),this.selected=null,this.dialog=!0},closeDialog(){this.dialog=!1},moveUp(){const a=this.tabs,t=this.selected,i=t-1;a.splice(i,2,a[t],a[i]),this.selected--},moveDown(){const a=this.tabs,t=this.selected,i=t+1;a.splice(t,2,a[i],a[t]),this.selected++},saveOrder(){this.$emit("update:modelValue",this.tabs),this.closeDialog()}}},F={name:"PsTabsEditable",components:{PsTabs:R,PsTabsEditableReorder:(0,E.A)(W,[["render",L]])},props:{tabs:{type:Array,required:!0},activeTabIdx:{type:Number,required:!0},editable:{type:Boolean,required:!1,default:!1},detachable:{type:Boolean,required:!1,default:!1}},emits:["tab-add","tab-remove","tab-update","tab-switch","tab-order","detach"],data(){return{editTabName:!1,tabModel:""}},computed:{multiTabs(){return this.tabs.length>1},updateWarning(){const a=this.tabModel,t=this.activeTabIdx;return this.tabs.some((i,m)=>i.title===a&&m!==t)}},watch:{editing(a){a||(this.editTabName=!1)}},methods:{onTabClick(a){!this.editable||this.tabs[this.activeTabIdx]!==a||(this.editTabName=!0,this.tabModel=a.title,this.$nextTick(()=>{this.$refs.input.focus(),this.$refs.input.select()}))},switchTab(a){this.cancelEdit(),this.$emit("tab-switch",a)},addTab(){this.$emit("tab-add")},saveEdit(){if(this.updateWarning)return;const a=this.tabModel;this.$emit("tab-update",a),this.cancelEdit()},cancelEdit(){this.editTabName=!1}}};var q=s(9504);const z=(0,E.A)(F,[["render",y]]),D="diagramTabs";function P(a){return a.reduce((t,i)=>{const m=/^-\s(\d+)\s-$/.exec(i.title);if(Array.isArray(m)){const u=Number(m[1]);return Math.max(t,u)}return t},0)}function V(a){return`- ${a} -`}const J={name:"PsDiagram",components:{PsTabsEditable:z},data(){return{editing:!1,tabs:[{title:"Default",value:"default"}],activeTabIdx:0,diagram:null}},mounted(){const[a,t]=x.s.get(D,[]);Array.isArray(t)&&(this.tabs=t.map(({t:i,n:m})=>({title:i,value:m})),a<t.length&&(this.activeTabIdx=a)),window.Diagram.create(this.tabs[this.activeTabIdx].value,this.$refs.diagram,{toolbar:!0,configs:this.tabs.map(i=>i.value)}).then(i=>{this.diagram=(0,e.markRaw)(i)})},beforeUnmount(){this.diagram&&this.diagram.destroy()},methods:{storeTabs(){const a=this.tabs.map(({title:t,value:i})=>({t,n:i}));x.s.set(D,[this.activeTabIdx,a])},switchTab(a){this.diagram&&(this.activeTabIdx=this.tabs.indexOf(a),this.editing||this.storeTabs(),this.diagram.selectConfig(a.value))},addTab(){if(!this.diagram)return;const a=this.tabs,t=V(P(this.tabs)+1);let i=(0,g.aq)();for(;a.some(m=>m.value===i);)i=(0,g.aq)();this.tabs.push({title:t,value:i}),this.activeTabIdx=this.tabs.length-1,this.diagram.createConfig(i)},removeTab(){if(!this.diagram||this.tabs.length<2)return;const a=this.tabs[this.activeTabIdx];confirm(`Remove '${a.title}' tab?`)&&(this.tabs=this.tabs.filter(t=>t!==a),this.activeTabIdx=0,this.diagram.selectConfig(this.tabs[0].value))},updateTab(a){const t=this.tabs[this.activeTabIdx];a?t.title=a:t.title=V(P(this.tabs.filter(i=>i!==t))+1)},orderTabs(a){const t=this.tabs[this.activeTabIdx];this.tabs=a,this.activeTabIdx=this.tabs.indexOf(t)},exportConfig(){if(!this.diagram)return;const a=this.tabs[this.activeTabIdx],t=this.diagram.getConfig(),i=a.title+".diagram";(0,g.Id)(JSON.stringify(t),i,"text/plain")},importConfig(a){if(!this.diagram||!a.target.files.length)return;let t=a.target.files[0].name.split(".")[0];t||(t=V(P(this.tabs)+1));const i=new FileReader;i.addEventListener("load",m=>{if(!m.target.result)return;let u;try{u=JSON.parse(m.target.result)}catch(c){return console.error(c)}const r=this.tabs.find(c=>c.title===t);if(!r)this.addTab();else{if(!confirm(`Loading a this configuration will overwrite all saved locations and devices from the '${t}' tab. Confirm?`))return;this.switchTab(r),r.title=t}this.diagram.applyConfig(u)}),i.readAsText(a.target.files[0])},resetConfig(){this.diagram&&confirm("Are you sure you want to clear all saved locations and revert all devices to natural float?")&&this.diagram.resetConfig()},lock(){this.editing=!1,this.storeTabs()}}},X=(0,E.A)(J,[["render",p]]);psState.selPage="diagram.html",(0,e.createApp)({render:()=>(0,e.h)(X)}).mount("#app")},9504:(l,n,s)=>{var e=s(1093);e.__esModule&&(e=e.default),typeof e=="string"&&(e=[[l.id,e,""]]),e.locals&&(l.exports=e.locals);var b=s(5083).A,o=b("0209a72d",e,!0,{})}},B={};function d(l){var n=B[l];if(n!==void 0)return n.exports;var s=B[l]={id:l,exports:{}};return N[l](s,s.exports,d),s.exports}d.m=N,(()=>{var l=[];d.O=(n,s,e,b)=>{if(s){b=b||0;for(var o=l.length;o>0&&l[o-1][2]>b;o--)l[o]=l[o-1];l[o]=[s,e,b];return}for(var v=1/0,o=0;o<l.length;o++){for(var[s,e,b]=l[o],_=!0,p=0;p<s.length;p++)(b&!1||v>=b)&&Object.keys(d.O).every(C=>d.O[C](s[p]))?s.splice(p--,1):(_=!1,b<v&&(v=b));if(_){l.splice(o--,1);var g=e();g!==void 0&&(n=g)}}return n}})(),d.n=l=>{var n=l&&l.__esModule?()=>l.default:()=>l;return d.d(n,{a:n}),n},d.d=(l,n)=>{for(var s in n)d.o(n,s)&&!d.o(l,s)&&Object.defineProperty(l,s,{enumerable:!0,get:n[s]})},d.o=(l,n)=>Object.prototype.hasOwnProperty.call(l,n),d.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},d.j=6338,(()=>{var l={6338:0};d.O.j=e=>l[e]===0;var n=(e,b)=>{var[o,v,_]=b,p,g,x=0;if(o.some(y=>l[y]!==0)){for(p in v)d.o(v,p)&&(d.m[p]=v[p]);if(_)var k=_(d)}for(e&&e(b);x<o.length;x++)g=o[x],d.o(l,g)&&l[g]&&l[g][0](),l[g]=0;return d.O(k)},s=self.webpackChunklib=self.webpackChunklib||[];s.forEach(n.bind(null,0)),s.push=n.bind(null,s.push.bind(s))})();var O=d.O(void 0,[2076],()=>d(4405));O=d.O(O)})();})();
